# ë©”ë””í˜ ì´ë½€ (MediHim Ippo) â€” AI ìƒë‹´ ë¦¬í¬íŠ¸ ì‹œìŠ¤í…œ

## í”„ë¡œì íŠ¸ ê°œìš”

ì¼ë³¸ ì˜ë£Œê´€ê´‘ í”Œë«í¼ ã€Œì´ë½€(ì´ë½€)ã€ì˜ AI ìƒë‹´ ë¦¬í¬íŠ¸ ì‹œìŠ¤í…œ.
ì¼ë³¸ì¸ ì†Œë¹„ìê°€ í•œêµ­ í”¼ë¶€ê³¼/ì„±í˜•ì™¸ê³¼ì— ëŒ€í•´ ìƒë‹´í•œ ë‚´ìš©(ì¼ë³¸ì–´ STT/ë‹¤ì´ì–¼ë¡œê·¸)ì„ AIê°€ ë¶„ì„í•˜ì—¬
êµ¬ì¡°í™”ëœ ì¼ë³¸ì–´ ë¦¬í¬íŠ¸ë¥¼ ìë™ ìƒì„±í•˜ê³ , ê´€ë¦¬ì ê²€í†  í›„ ì´ë©”ì¼/URLë¡œ ì†Œë¹„ìì—ê²Œ ë°œì†¡í•œë‹¤.

---

## ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ
- **í”„ë ˆì„ì›Œí¬**: Next.js 14+ (App Router)
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS
- **ë°°í¬**: Vercel Pro
- **ìš©ë„**: ê´€ë¦¬ìí˜ì´ì§€(í•œêµ­ì–´) + ì†Œë¹„ì ë¦¬í¬íŠ¸ ì›¹í˜ì´ì§€(ì¼ë³¸ì–´)

### ë°±ì—”ë“œ
- **í”„ë ˆì„ì›Œí¬**: Python FastAPI
- **ë°°í¬**: Google Cloud Run
- **ìš©ë„**: AI ì—ì´ì „íŠ¸ íŒŒì´í”„ë¼ì¸, YouTube ìë§‰ ìˆ˜ì§‘, ë²¡í„°DB êµ¬ì¶•, ì´ë©”ì¼ ë°œì†¡

### ë°ì´í„°ë² ì´ìŠ¤
- **Supabase** (PostgreSQL + pgvector í™•ì¥)
- ì¼ë°˜ ë°ì´í„° + ë²¡í„° ì„ë² ë”© ëª¨ë‘ Supabaseì—ì„œ ê´€ë¦¬

### AI/ML
- **LLM**: Google Gemini API (í…ìŠ¤íŠ¸ ìƒì„± + ì„ë² ë”© ëª¨ë‘ ë™ì¼ API í‚¤)
- **ì„ë² ë”©**: Gemini Embedding 768ì°¨ì›
- **ë²¡í„° ê²€ìƒ‰**: Supabase pgvector

### ì´ë©”ì¼
- **Resend** (ë¬´ë£Œ í”Œëœ: ì›” 3,000ê±´, ì¼ 100ê±´)
- ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì„¤ì • ê°€ëŠ¥

---

## í™˜ê²½ë³€ìˆ˜ (.env)

```env
GEMINI_API_KEY=           # Gemini API (LLM + ì„ë² ë”© ëª¨ë‘)
SUPABASE_URL=             # Supabase í”„ë¡œì íŠ¸ URL
SUPABASE_SERVICE_KEY=     # Supabase ì„œë¹„ìŠ¤ í‚¤ (ì„œë²„ ì „ìš©)
RESEND_API_KEY=           # Resend ì´ë©”ì¼ ë°œì†¡
YOUTUBE_API_KEY=          # YouTube Data API v3
REPLY_TO_EMAIL=           # íšŒì‹  ìˆ˜ì‹  ì´ë©”ì¼ (í˜„ì¬ ê°œì¸ ê³„ì •, ì¶”í›„ êµì²´)
```

> âš ï¸ ëª¨ë“  API í‚¤ëŠ” ì„œë²„ë‹¨(.env)ì—ì„œë§Œ ê´€ë¦¬. ê´€ë¦¬ìí˜ì´ì§€ UIì— ì ˆëŒ€ ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.

---

## í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
ippo/
â”œâ”€â”€ frontend/                    # Next.js (Vercel ë°°í¬)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ admin/               # ê´€ë¦¬ìí˜ì´ì§€ (í•œêµ­ì–´)
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # ëŒ€ì‹œë³´ë“œ
â”‚   â”‚   â”‚   â”œâ”€â”€ consultations/   # ìƒë‹´ ê´€ë¦¬
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx     # ìƒë‹´ ëª©ë¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ new/page.tsx # ìƒˆ ìƒë‹´ ë“±ë¡
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/page.tsx # ìƒë‹´ ìƒì„¸
â”‚   â”‚   â”‚   â”œâ”€â”€ unclassified/    # ë¯¸ë¶„ë¥˜ ì²˜ë¦¬
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ reports/         # ë¦¬í¬íŠ¸ ê´€ë¦¬
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx     # ë¦¬í¬íŠ¸ ëª©ë¡
â”‚   â”‚   â”‚       â””â”€â”€ [id]/page.tsx # ë¦¬í¬íŠ¸ ìƒì„¸/ê²€í† 
â”‚   â”‚   â”œâ”€â”€ report/              # ì†Œë¹„ì ë¦¬í¬íŠ¸ (ì¼ë³¸ì–´)
â”‚   â”‚   â”‚   â””â”€â”€ [token]/page.tsx # í† í° ê¸°ë°˜ ë¦¬í¬íŠ¸ ì—´ëŒ
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx             # ë£¨íŠ¸ â†’ /admin ë¦¬ë‹¤ì´ë ‰íŠ¸
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ admin/               # ê´€ë¦¬ìí˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardCards.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ConsultationTable.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ConsultationForm.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ UnclassifiedModal.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReportPreview.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReportReviewPanel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ShareButton.tsx       # URL ê³µìœ  (ë§í¬ ë³µì‚¬ + LINE)
â”‚   â”‚   â”‚   â””â”€â”€ CTABadge.tsx
â”‚   â”‚   â””â”€â”€ report/              # ì†Œë¹„ì ë¦¬í¬íŠ¸ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚       â”œâ”€â”€ ReportHeader.tsx
â”‚   â”‚       â”œâ”€â”€ Section1Summary.tsx
â”‚   â”‚       â”œâ”€â”€ Section2Direction.tsx
â”‚   â”‚       â”œâ”€â”€ Section3Concerns.tsx
â”‚   â”‚       â”œâ”€â”€ Section4Medical.tsx
â”‚   â”‚       â”œâ”€â”€ Section5Proposal.tsx
â”‚   â”‚       â”œâ”€â”€ Section6Options.tsx
â”‚   â”‚       â”œâ”€â”€ Section7Recovery.tsx
â”‚   â”‚       â””â”€â”€ ReportFooter.tsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts          # Supabase í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ api.ts               # Cloud Run API í˜¸ì¶œ í•¨ìˆ˜
â”‚   â”œâ”€â”€ design-reference/        # Google Stitch HTML ë ˆí¼ëŸ°ìŠ¤
â”‚   â”‚   â”œâ”€â”€ report-template.html # ë¦¬í¬íŠ¸ ë””ìì¸ ì›ë³¸ (ì´ íŒŒì¼ ì°¸ê³ í•´ì„œ ì½”ë”©)
â”‚   â”‚   â””â”€â”€ admin-template.html  # ê´€ë¦¬ìí˜ì´ì§€ ë””ìì¸ ì›ë³¸ (ì´ íŒŒì¼ ì°¸ê³ í•´ì„œ ì½”ë”©)
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ next.config.js
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ backend/                     # Python FastAPI (Cloud Run ë°°í¬)
â”‚   â”œâ”€â”€ main.py                  # FastAPI ì•± ì—”íŠ¸ë¦¬
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ consultation.py      # ìƒë‹´ ë“±ë¡/ì¡°íšŒ API
â”‚   â”‚   â”œâ”€â”€ report.py            # ë¦¬í¬íŠ¸ ìŠ¹ì¸/ë°œì†¡ API
â”‚   â”‚   â”œâ”€â”€ classify.py          # ìˆ˜ë™ ë¶„ë¥˜ API
â”‚   â”‚   â””â”€â”€ youtube.py           # YouTube ìë§‰ ìˆ˜ì§‘ API
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ pipeline.py          # ì „ì²´ íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
â”‚   â”‚   â”œâ”€â”€ translator.py        # ë²ˆì—­ ì—ì´ì „íŠ¸ (ì¼â†’í•œ)
â”‚   â”‚   â”œâ”€â”€ intent_extractor.py  # ì˜ë„ ì¶”ì¶œ ì—ì´ì „íŠ¸
â”‚   â”‚   â”œâ”€â”€ classifier.py        # ë¶„ë¥˜ ì—ì´ì „íŠ¸
â”‚   â”‚   â”œâ”€â”€ validator.py         # ê²€ì¦ ì—ì´ì „íŠ¸
â”‚   â”‚   â”œâ”€â”€ rag_agent.py         # RAG ì—ì´ì „íŠ¸ (ê³¼ë³„ ë²¡í„°DB ê²€ìƒ‰)
â”‚   â”‚   â”œâ”€â”€ report_writer.py     # ë¦¬í¬íŠ¸ ì‘ì„± ì—ì´ì „íŠ¸
â”‚   â”‚   â”œâ”€â”€ report_reviewer.py   # ê²€í†  ì—ì´ì „íŠ¸ (max 3íšŒ)
â”‚   â”‚   â”œâ”€â”€ cta_analyzer.py      # CTA ë¶„ì„ ì—ì´ì „íŠ¸ (ê³ ê° ë°œí™” ê¸°ë°˜)
â”‚   â”‚   â””â”€â”€ korean_translator.py # ë¦¬í¬íŠ¸ í•œê¸€ ë²ˆì—­ ì—ì´ì „íŠ¸
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ supabase_client.py   # Supabase ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ gemini_client.py     # Gemini API (LLM + ì„ë² ë”©)
â”‚   â”‚   â”œâ”€â”€ email_service.py     # Resend ì´ë©”ì¼ ë°œì†¡
â”‚   â”‚   â””â”€â”€ youtube_service.py   # YouTube ìë§‰ ìˆ˜ì§‘ + ì •ì œ + FAQ ë³€í™˜
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ schemas.py           # Pydantic ë°ì´í„° ëª¨ë¸
â”‚   â”œâ”€â”€ config.py                # í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ Dockerfile               # Cloud Run ë°°í¬ìš©
â”‚
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ migrations/
â”‚       â””â”€â”€ 001_initial_schema.sql  # ì „ì²´ DB ìŠ¤í‚¤ë§ˆ
â”‚
â”œâ”€â”€ CLAUDE.md                    # ì´ íŒŒì¼
â””â”€â”€ .env                         # í™˜ê²½ë³€ìˆ˜ (gitignore)
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (Supabase PostgreSQL + pgvector)

### pgvector í™•ì¥ í™œì„±í™”

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

### í…Œì´ë¸”

```sql
-- ============================================
-- 1. ìƒë‹´ í…Œì´ë¸”
-- ============================================
CREATE TABLE consultations (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    customer_name TEXT NOT NULL,
    customer_email TEXT NOT NULL,
    customer_line_id TEXT,
    
    -- ì›ë¬¸ ë° ë²ˆì—­
    original_text TEXT NOT NULL,           -- ì¼ë³¸ì–´ ì›ë¬¸ (STT/ë‹¤ì´ì–¼ë¡œê·¸)
    translated_text TEXT,                  -- í•œêµ­ì–´ ë²ˆì—­ë³¸
    
    -- í™”ì ë¶„ë¦¬ ë°ì´í„°
    speaker_segments JSONB,               -- [{speaker: "counselor"|"customer", text: "..."}]
    customer_utterances TEXT,              -- ê³ ê° ë°œí™”ë§Œ ì¶”ì¶œí•œ í…ìŠ¤íŠ¸
    
    -- AI ë¶„ë¥˜ ê²°ê³¼
    classification TEXT CHECK (classification IN ('dermatology', 'plastic_surgery', 'unclassified')),
    classification_confidence FLOAT,
    classification_reason TEXT,            -- ë¶„ë¥˜ ê·¼ê±° ì„¤ëª…
    is_manually_classified BOOLEAN DEFAULT FALSE,
    
    -- AI ì˜ë„ ì¶”ì¶œ ê²°ê³¼
    intent_extraction JSONB,
    -- êµ¬ì¡°:
    -- {
    --   "main_concerns": ["ì½”ë ë¾°ì¡±í•¨", "ì´ë¬¼ê°"],
    --   "desired_direction": "ëœ ë¾°ì¡±í•˜ê²Œ, ìì—°ìŠ¤ëŸ½ê²Œ",
    --   "unwanted": "ê³¼ë„í•œ ë†’ì´ ë³€í™”",
    --   "mentioned_procedures": ["ì½”ë ì¬ìˆ˜ìˆ ", "ê·€ì—°ê³¨ í™œìš©"],
    --   "keywords": ["ì½”ë", "ì¬ìˆ˜ìˆ ", "ìì—°ìŠ¤ëŸ¬ì›€"]
    -- }
    
    -- CTA ë¶„ì„ (ê³ ê° ë°œí™” ê¸°ë°˜)
    cta_level TEXT CHECK (cta_level IN ('hot', 'warm', 'cool')),
    cta_signals JSONB,                    -- íŒë‹¨ ê·¼ê±° ê³ ê° ë°œí™” ëª©ë¡
    -- êµ¬ì¡°: ["7æœˆã«åˆã‚ã›ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ", "è²»ç”¨ã¯ã©ã®ãã‚‰ã„ï¼Ÿ"]
    
    -- ìƒíƒœ
    status TEXT DEFAULT 'processing' CHECK (status IN (
        'processing',        -- íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬ ì¤‘
        'classification_pending',  -- ë¯¸ë¶„ë¥˜ (ìˆ˜ë™ ë¶„ë¥˜ ëŒ€ê¸°)
        'report_generating', -- ë¦¬í¬íŠ¸ ìƒì„± ì¤‘
        'report_ready',      -- ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ (ê²€í†  ëŒ€ê¸°)
        'report_approved',   -- ìŠ¹ì¸ ì™„ë£Œ
        'report_sent',       -- ë°œì†¡ ì™„ë£Œ
        'report_failed'      -- ì²˜ë¦¬ ì‹¤íŒ¨
    )),
    error_message TEXT,                   -- ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- 2. ë¦¬í¬íŠ¸ í…Œì´ë¸”
-- ============================================
CREATE TABLE reports (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    consultation_id UUID REFERENCES consultations(id) ON DELETE CASCADE,
    
    -- ë¦¬í¬íŠ¸ ë‚´ìš© (7ì„¹ì…˜)
    report_data JSONB NOT NULL,
    -- êµ¬ì¡°:
    -- {
    --   "title": "OOæ§˜ é¼»å†æ‰‹è¡“ã®ã”ç›¸è«‡ã¾ã¨ã‚",
    --   "section1_summary": { "text": "...", "points": [...] },
    --   "section2_direction": { "desired": [...], "quote": "..." },
    --   "section3_concerns": { "points": [...], "supplement": "..." },
    --   "section4_medical": { "explanations": [...], "footnote": "..." },
    --   "section5_proposal": { "steps": [...] },
    --   "section6_options": { "recommended": [...], "optional": [...], "unnecessary": [...], "comment": "..." },
    --   "section7_recovery": { "info": [...], "closing_comment": "..." }
    -- }
    
    -- í•œêµ­ì–´ ë²ˆì—­ë³¸
    report_data_ko JSONB,                 -- ë™ì¼ êµ¬ì¡°ì˜ í•œêµ­ì–´ ë²„ì „
    
    -- RAG ì»¨í…ìŠ¤íŠ¸ (ì–´ë–¤ ë²¡í„°DB ë°ì´í„°ë¥¼ ì°¸ì¡°í–ˆëŠ”ì§€)
    rag_context JSONB,
    -- êµ¬ì¡°: [{"faq_id": "...", "question": "...", "answer": "...", "similarity": 0.89}]
    
    -- ê²€í†  ìƒíƒœ
    review_count INT DEFAULT 0,           -- ê²€í†  ì—ì´ì „íŠ¸ ì‹œë„ íšŸìˆ˜ (max 3)
    review_passed BOOLEAN DEFAULT FALSE,
    review_notes TEXT,
    
    -- ë°œì†¡ ì •ë³´
    access_token TEXT UNIQUE,             -- ë¦¬í¬íŠ¸ ì—´ëŒ URL í† í°
    access_expires_at TIMESTAMPTZ,        -- í† í° ìœ íš¨ê¸°ê°„ (30ì¼)
    
    -- ì´ë©”ì¼ ë°œì†¡
    email_sent_at TIMESTAMPTZ,
    email_opened_at TIMESTAMPTZ,          -- ì—´ëŒ ì¶”ì 
    
    -- ìƒíƒœ
    status TEXT DEFAULT 'draft' CHECK (status IN (
        'draft',          -- ìƒì„± ì™„ë£Œ (ê²€í†  ì „)
        'approved',       -- ê´€ë¦¬ì ìŠ¹ì¸
        'rejected',       -- ê´€ë¦¬ì ë°˜ë ¤
        'sent'            -- ë°œì†¡ ì™„ë£Œ
    )),
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- 3. ë²¡í„°DB - FAQ í…Œì´ë¸” (YouTube ê¸°ë°˜)
-- ============================================
CREATE TABLE faq_vectors (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    
    -- ì¹´í…Œê³ ë¦¬ (í•„í„° ê²€ìƒ‰ìš©)
    category TEXT NOT NULL CHECK (category IN ('dermatology', 'plastic_surgery')),
    
    -- FAQ ë‚´ìš©
    question TEXT NOT NULL,               -- í™˜ì ê´€ì  ì§ˆë¬¸
    answer TEXT NOT NULL,                 -- ì˜ë£Œì§„ ì„¤ëª… (ê·¼ê±° í¬í•¨)
    procedure_name TEXT,                  -- ê´€ë ¨ ì‹œìˆ ëª…
    
    -- ë²¡í„° ì„ë² ë”©
    embedding vector(768) NOT NULL,       -- Gemini Embedding 768ì°¨ì›
    
    -- ì¶œì²˜
    youtube_video_id TEXT,
    youtube_title TEXT,
    youtube_url TEXT,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ë²¡í„° ê²€ìƒ‰ ì¸ë±ìŠ¤
CREATE INDEX ON faq_vectors USING ivfflat (embedding vector_cosine_ops) WITH (lists = 100);

-- ì¹´í…Œê³ ë¦¬ í•„í„° ì¸ë±ìŠ¤
CREATE INDEX ON faq_vectors (category);

-- ============================================
-- 4. YouTube ì†ŒìŠ¤ ê´€ë¦¬ í…Œì´ë¸”
-- ============================================
CREATE TABLE youtube_sources (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    video_id TEXT UNIQUE NOT NULL,
    title TEXT,
    url TEXT,
    channel_name TEXT,
    category TEXT CHECK (category IN ('dermatology', 'plastic_surgery')),
    
    -- ì²˜ë¦¬ ìƒíƒœ
    status TEXT DEFAULT 'pending' CHECK (status IN (
        'pending',         -- ëŒ€ê¸°
        'transcript_fetched', -- ìë§‰ ì¶”ì¶œ ì™„ë£Œ
        'refined',         -- LLM ì •ì œ ì™„ë£Œ
        'faq_generated',   -- FAQ ë³€í™˜ ì™„ë£Œ
        'embedded',        -- ì„ë² ë”© ì™„ë£Œ
        'skipped',         -- ìë™ìë§‰ ì—†ì–´ì„œ ìŠ¤í‚µ
        'failed'           -- ì²˜ë¦¬ ì‹¤íŒ¨
    )),
    
    raw_transcript TEXT,                  -- ì›ë³¸ ìë§‰
    refined_transcript TEXT,              -- ì •ì œëœ ìë§‰
    faq_count INT DEFAULT 0,             -- ìƒì„±ëœ FAQ ìˆ˜
    
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- 5. ë¶„ë¥˜ í‚¤ì›Œë“œ ì‚¬ì „ í…Œì´ë¸”
-- ============================================
CREATE TABLE classification_keywords (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    category TEXT NOT NULL CHECK (category IN ('dermatology', 'plastic_surgery', 'boundary')),
    keyword TEXT NOT NULL,
    context_keywords JSONB,               -- ê²½ê³„ ì‹œìˆ ì˜ ê²½ìš° ë™ë°˜ í‚¤ì›Œë“œ
    -- êµ¬ì¡°: {"plastic_surgery": ["ì½” ë†’ì´ê¸°", "ìœ¤ê³½"], "dermatology": ["ë ˆì´ì €", "í”¼ë¶€ê²°"]}
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ============================================
-- 6. ì—ì´ì „íŠ¸ ì²˜ë¦¬ ë¡œê·¸ í…Œì´ë¸”
-- ============================================
CREATE TABLE agent_logs (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    consultation_id UUID REFERENCES consultations(id) ON DELETE CASCADE,
    agent_name TEXT NOT NULL,             -- 'translator', 'classifier', 'rag', 'report_writer' ë“±
    input_data JSONB,
    output_data JSONB,
    duration_ms INT,
    status TEXT CHECK (status IN ('success', 'failed', 'retry')),
    error_message TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### ë²¡í„° ê²€ìƒ‰ í•¨ìˆ˜ (Supabase RPC)

```sql
-- í”¼ë¶€ê³¼ ë˜ëŠ” ì„±í˜•ì™¸ê³¼ ì¹´í…Œê³ ë¦¬ í•„í„°ë§ + ìœ ì‚¬ë„ ê²€ìƒ‰
CREATE OR REPLACE FUNCTION search_faq(
    query_embedding vector(768),
    target_category TEXT,
    match_threshold FLOAT DEFAULT 0.7,
    match_count INT DEFAULT 5
)
RETURNS TABLE (
    id UUID,
    question TEXT,
    answer TEXT,
    procedure_name TEXT,
    youtube_url TEXT,
    similarity FLOAT
)
LANGUAGE plpgsql
AS $$
BEGIN
    RETURN QUERY
    SELECT
        fv.id,
        fv.question,
        fv.answer,
        fv.procedure_name,
        fv.youtube_url,
        1 - (fv.embedding <=> query_embedding) AS similarity
    FROM faq_vectors fv
    WHERE fv.category = target_category
        AND 1 - (fv.embedding <=> query_embedding) > match_threshold
    ORDER BY fv.embedding <=> query_embedding
    LIMIT match_count;
END;
$$;
```

---

## AI ì—ì´ì „íŠ¸ íŒŒì´í”„ë¼ì¸ â€” ìƒì„¸ ì„¤ê³„

### ì „ì²´ íë¦„

```
[STT/ë‹¤ì´ì–¼ë¡œê·¸ ì…ë ¥ (ì¼ë³¸ì–´)]
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ë²ˆì—­ Agent     â”‚ â†’ ì¼ë³¸ì–´ â†’ í•œêµ­ì–´ ë²ˆì—­ (ì›ë¬¸ ë³´ì¡´)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ í™”ì ë¶„ë¦¬      â”‚ â†’ ìƒë‹´ì‚¬ ë°œí™” / ê³ ê° ë°œí™” ë¶„ë¦¬
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€ ê³ ê° ë°œí™” â†’ CTA ë¶„ì„ Agent â†’ Hot/Warm/Cool + ê·¼ê±° ì €ì¥
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ì˜ë„ ì¶”ì¶œ Agent â”‚ â†’ í•µì‹¬ ì‹œìˆ  ëª©ì , í¬ë§ ì‹œìˆ ëª…, ë¶€ìœ„, í‚¤ì›Œë“œ ì¶”ì¶œ
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ë¶„ë¥˜ Agent     â”‚ â†’ ë¶„ë¥˜ ê°€ì´ë“œ(ë£°ì…‹) + í‚¤ì›Œë“œ ì‚¬ì „ ì°¸ì¡°
    â”‚ + ê²½ê³„ì‹œìˆ  ë£°ì…‹  â”‚    í”¼ë¶€ê³¼ / ì„±í˜•ì™¸ê³¼ / íŒë‹¨ë¶ˆê°€
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ (ì‹ ë¢°ë„ ë‚®ê±°ë‚˜ ê²½ê³„ ì‹œìˆ ì¼ ë•Œ)
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ê²€ì¦ Agent     â”‚ â†’ ë¶„ë¥˜ í™•ì • or ê´€ë¦¬ì ê²€í†  í”Œë˜ê·¸(unclassified)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (unclassifiedë©´ ì—¬ê¸°ì„œ ì¤‘ë‹¨, ê´€ë¦¬ì ìˆ˜ë™ ë¶„ë¥˜ ëŒ€ê¸°)
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚í”¼ë¶€ê³¼ RAG â”‚      â”‚ì„±í˜•ì™¸ê³¼ RAG â”‚
    â”‚Agent     â”‚      â”‚Agent      â”‚
    â”‚(category:â”‚      â”‚(category: â”‚
    â”‚dermatology)     â”‚plastic_surgery)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
             â”‚ë¦¬í¬íŠ¸ ì‘ì„±  â”‚ â†’ 7ì„¹ì…˜ ì¼ë³¸ì–´ ë¦¬í¬íŠ¸ ìƒì„±
             â”‚Agent      â”‚    (í•œêµ­ì–´ RAG ë°ì´í„° + ì¼ë³¸ì–´ ì›ë¬¸ ì°¸ì¡°)
             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
             â”‚ ê²€í†  Agent  â”‚ â†’ Pass/Fail (max 3íšŒ ì¬ì‹œë„)
             â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
            [DB ì €ì¥ â†’ ê´€ë¦¬ì ê²€í†  ëŒ€ê¸°]
```

### ë¹„ë™ê¸° ì²˜ë¦¬

ìƒë‹´ ë“±ë¡ APIëŠ” ì¦‰ì‹œ ì‘ë‹µ("ì²˜ë¦¬ ì¤‘")ì„ ë°˜í™˜í•˜ê³ , íŒŒì´í”„ë¼ì¸ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•œë‹¤.
ê´€ë¦¬ìí˜ì´ì§€ì—ì„œ ìƒíƒœê°€ "ì²˜ë¦¬ ì¤‘ â†’ ìƒì„±ì™„ë£Œ"ë¡œ ë³€ê²½ë˜ëŠ” ê²ƒì„ í™•ì¸í•œë‹¤.

```python
# backend/api/consultation.py
@app.post("/api/consultations")
async def create_consultation(data: ConsultationCreate):
    # 1. DBì— ìƒë‹´ ë°ì´í„° ì €ì¥ (status: 'processing')
    consultation = save_to_db(data)
    
    # 2. ë°±ê·¸ë¼ìš´ë“œì—ì„œ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
    background_tasks.add_task(run_pipeline, consultation.id)
    
    # 3. ì¦‰ì‹œ ì‘ë‹µ
    return {"id": consultation.id, "status": "processing"}
```

---

## ê° ì—ì´ì „íŠ¸ ìƒì„¸ ì„¤ê³„

### 1. ë²ˆì—­ ì—ì´ì „íŠ¸ (translator.py)

```
ì…ë ¥: ì¼ë³¸ì–´ STT/ë‹¤ì´ì–¼ë¡œê·¸ ì›ë¬¸
ì¶œë ¥: í•œêµ­ì–´ ë²ˆì—­ë³¸
ëª¨ë¸: Gemini
```

**í”„ë¡¬í”„íŠ¸ í•µì‹¬:**
- ì˜ë£Œ ìš©ì–´ ì •í™•íˆ ë²ˆì—­ (ì‹œìˆ ëª…, ë¶€ìœ„ëª…)
- ë‰˜ì•™ìŠ¤ ë³´ì¡´ (í™˜ìì˜ ë¶ˆì•ˆê°, ìš”ì²­ ì •ë„ ë“±)
- ê³ ìœ ëª…ì‚¬ëŠ” ì›ë¬¸ ë³‘ê¸°

**ì¤‘ìš”: ì¼ë³¸ì–´ ì›ë¬¸ì€ ë°˜ë“œì‹œ DBì— ë³´ì¡´í•œë‹¤.** ë¦¬í¬íŠ¸ ì‘ì„± ì—ì´ì „íŠ¸ê°€ ìµœì¢… ì¼ë³¸ì–´ ë¦¬í¬íŠ¸ ì‘ì„± ì‹œ ì°¸ì¡°í•´ì•¼ ìì—°ìŠ¤ëŸ¬ìš´ ì¼ë³¸ì–´ í‘œí˜„ì´ ë‚˜ì˜¨ë‹¤.

### 2. í™”ì ë¶„ë¦¬ + CTA ë¶„ì„ ì—ì´ì „íŠ¸ (cta_analyzer.py)

```
ì…ë ¥: ì¼ë³¸ì–´ ì›ë¬¸ + í•œêµ­ì–´ ë²ˆì—­ë³¸
ì¶œë ¥: í™”ìë³„ ë°œí™” ì„¸ê·¸ë¨¼íŠ¸ + CTA ë ˆë²¨ + ê·¼ê±°
```

**í™”ì ë¶„ë¦¬:** LLMì—ê²Œ ëŒ€í™” êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ê²Œ í•˜ì—¬ ìƒë‹´ì‚¬/ê³ ê° ë°œí™”ë¥¼ ë¶„ë¦¬í•œë‹¤.

**CTA íŒë‹¨ ê¸°ì¤€ (ê³ ê° ë°œí™”ë§Œ ë¶„ì„):**

| ë ˆë²¨ | ì‹ í˜¸ | ì˜ˆì‹œ ë°œí™” |
|------|------|-----------|
| Hot | êµ¬ì²´ì  ì¼ì •/ë¹„ìš© ì§ˆë¬¸ | "7æœˆã«å¯èƒ½ã§ã™ã‹ï¼Ÿ", "è²»ç”¨ã¯ã„ãã‚‰ï¼Ÿ", "å›å¾©æœŸé–“ã¯ï¼Ÿ" |
| Warm | ê´€ì‹¬ ìˆì§€ë§Œ ë¹„êµ/ê³ ë¯¼ | "ä»–ã®ç—…é™¢ã§ã¯ã€œ", "ã‚‚ã†å°‘ã—èª¿ã¹ãŸã„", "å®¶æ—ã¨ç›¸è«‡ã—ã¾ã™" |
| Cool | ì •ë³´ íƒìƒ‰ | "ã¡ã‚‡ã£ã¨æ°—ã«ãªã£ã¦", "ã¾ã å…·ä½“çš„ã«ã¯", "ã„ã¤ã‹æ©Ÿä¼šãŒã‚ã‚Œã°" |

**ì¶œë ¥ ì €ì¥:**
- `consultations.cta_level`: "hot" / "warm" / "cool"
- `consultations.cta_signals`: ê·¼ê±° ë°œí™” JSON ë°°ì—´ (ì¼ë³¸ì–´)
- `consultations.speaker_segments`: ì „ì²´ í™”ì ë¶„ë¦¬ ë°ì´í„°
- `consultations.customer_utterances`: ê³ ê° ë°œí™” í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ

### 3. ì˜ë„ ì¶”ì¶œ ì—ì´ì „íŠ¸ (intent_extractor.py)

```
ì…ë ¥: í•œêµ­ì–´ ë²ˆì—­ë³¸
ì¶œë ¥: êµ¬ì¡°í™”ëœ ì˜ë„ ë°ì´í„°
```

**ì¶”ì¶œ í•­ëª©:**
```json
{
    "main_concerns": ["ì½”ë ë¾°ì¡±í•¨", "ì´ë¬¼ê°", "ë¶€ìì—°ìŠ¤ëŸ¬ì›€"],
    "desired_direction": "ëœ ë¾°ì¡±í•˜ê²Œ, ëœ í‹°ë‚˜ê²Œ, ìì—°ìŠ¤ëŸ½ê²Œ",
    "unwanted": "ê³¼ë„í•œ ë†’ì´ ë³€í™”, ë„ˆë¬´ í° ë³€í™”",
    "mentioned_procedures": ["ì½”ë ì¬ìˆ˜ìˆ ", "ê·€ì—°ê³¨ í™œìš©"],
    "body_parts": ["ì½”ë", "ì½”ë“±"],
    "keywords": ["ì½”ë", "ì¬ìˆ˜ìˆ ", "ìì—°ìŠ¤ëŸ¬ì›€", "ê·€ì—°ê³¨"]
}
```

### 4. ë¶„ë¥˜ ì—ì´ì „íŠ¸ (classifier.py)

```
ì…ë ¥: í•œêµ­ì–´ ë²ˆì—­ë³¸ + ì˜ë„ ì¶”ì¶œ ê²°ê³¼ + í‚¤ì›Œë“œ ì‚¬ì „ (DBì—ì„œ ì¡°íšŒ)
ì¶œë ¥: í”¼ë¶€ê³¼ / ì„±í˜•ì™¸ê³¼ / ë¯¸ë¶„ë¥˜
```

**ë‹¨ì¼ ë¶„ë¥˜ ì›ì¹™**: í”¼ë¶€ê³¼ OR ì„±í˜•ì™¸ê³¼. í˜¼í•© ë¶„ë¥˜ ë¶ˆê°€.
**ë¶„ë¥˜ ê¸°ì¤€**: í•µì‹¬ ì˜ë„(ì£¼ì†Œ)ê°€ ê¸°ì¤€.

**ë¶„ë¥˜ ë¡œì§:**

#### ëª…í™• ë¶„ë¥˜ í‚¤ì›Œë“œ (DB: classification_keywords í…Œì´ë¸”ì—ì„œ ì¡°íšŒ)

**ì„±í˜•ì™¸ê³¼ (plastic_surgery):**
ìŒêº¼í’€, ì½” ì„±í˜•, ì½”ë, ì½”ë“±, ì§€ë°©í¡ì…, ì•ˆë©´ìœ¤ê³½, ì–‘ì•…, ì´ë§ˆ ë¦¬í”„íŒ…, ëˆˆ ì¬ìˆ˜ìˆ , ê°€ìŠ´ ìˆ˜ìˆ , í„± ìˆ˜ìˆ , Vë¼ì¸, ë¦¬í”„íŒ… ì‹¤

**í”¼ë¶€ê³¼ (dermatology):**
ì—¬ë“œë¦„, ê¸°ë¯¸, ìƒ‰ì†Œ, ëª¨ê³µ, íƒˆëª¨ ì¹˜ë£Œ, ë ˆì´ì €, í•˜ì´í‘¸, ìš¸ì„ë¼, í”¼ë¶€ê²°, ì£¼ë¦„ ê°œì„ , íƒ„ë ¥, ë¦¬ì¥¬ë€, ìŠ¤í‚¨ ë¶€ìŠ¤í„°

#### ê²½ê³„ ì‹œìˆ  (ë³´í†¡ìŠ¤, í•„ëŸ¬) ì²˜ë¦¬ ê·œì¹™

1. **ë™ë°˜ í‚¤ì›Œë“œ ê¸°ë°˜ ë¶„ë¥˜:**
   - ì„±í˜• ë§¥ë½ ë‹¨ì–´ ë™ë°˜ â†’ ì„±í˜•ì™¸ê³¼
     - "ì½” ë†’ì´ê¸°, í„± ë, ìœ¤ê³½, ì´ë§ˆ ë³¼ë¥¨, ë¦¬í”„íŒ… ì‹¤"ê³¼ í•¨ê»˜ ì–¸ê¸‰
   - í”¼ë¶€ ê´€ë¦¬ ë§¥ë½ ë‹¨ì–´ ë™ë°˜ â†’ í”¼ë¶€ê³¼
     - "ë ˆì´ì €, í•˜ì´í‘¸, ìš¸ì„ë¼, í”¼ë¶€ê²°, ì£¼ë¦„ ê°œì„ , íƒ„ë ¥, ë¦¬ì¥¬ë€"ê³¼ í•¨ê»˜ ì–¸ê¸‰

2. **ë§¥ë½ ë‹¨ì„œ ì—†ìœ¼ë©´** â†’ `unclassified` (ê´€ë¦¬ì ìˆ˜ë™ ë¶„ë¥˜ ëŒ€ê¸°)

#### ë³µí•© ë‹ˆì¦ˆ ì˜ˆì‹œ
- "ì—¬ë“œë¦„ í‰í„° ì‹¬í•´ì„œ ì½” ë†’ì´ê³  ì‹¶ì–´ìš”" â†’ ì„±í˜•ì™¸ê³¼ (ì½” ì„±í˜•ì´ ì£¼ ëª©ì )
- "í”¼ë¶€ ê´€ë¦¬ ë°›ìœ¼ë©´ì„œ ë³´í†¡ìŠ¤ë„ ë§ê³  ì‹¶ì–´ìš”" â†’ í”¼ë¶€ê³¼ (í”¼ë¶€ ê´€ë¦¬ê°€ ì£¼ ëª©ì )

### 5. ê²€ì¦ ì—ì´ì „íŠ¸ (validator.py)

```
ì…ë ¥: ë¶„ë¥˜ Agentì˜ ë¶„ë¥˜ ê²°ê³¼ + ì‹ ë¢°ë„
ì¶œë ¥: ë¶„ë¥˜ í™•ì • or ê´€ë¦¬ì ê²€í†  í”Œë˜ê·¸
```

- ë¶„ë¥˜ ì‹ ë¢°ë„ê°€ ë†’ê³  ëª…í™• í‚¤ì›Œë“œ ë§¤ì¹­ì´ë©´ â†’ ë°”ë¡œ í™•ì •
- ê²½ê³„ ì‹œìˆ ì´ê±°ë‚˜ ì‹ ë¢°ë„ ë‚®ìœ¼ë©´ â†’ `unclassified`ë¡œ í”Œë˜ê·¸, íŒŒì´í”„ë¼ì¸ ì¤‘ë‹¨
- `unclassified`ì¸ ìƒë‹´ì€ ê´€ë¦¬ìê°€ ìˆ˜ë™ ë¶„ë¥˜ í›„ íŒŒì´í”„ë¼ì¸ ì¬ê°œ

### 6. RAG ì—ì´ì „íŠ¸ (rag_agent.py)

```
ì…ë ¥: í•œêµ­ì–´ í‚¤ì›Œë“œ + ë¶„ë¥˜ ê²°ê³¼ (í”¼ë¶€ê³¼ or ì„±í˜•ì™¸ê³¼)
ì¶œë ¥: ê´€ë ¨ FAQ ë°ì´í„° (ìƒìœ„ 5ê°œ)
```

**ê²€ìƒ‰ íë¦„:**
1. ì˜ë„ ì¶”ì¶œì—ì„œ ë‚˜ì˜¨ í‚¤ì›Œë“œë¥¼ Gemini Embeddingìœ¼ë¡œ 768ì°¨ì› ë²¡í„° ìƒì„±
2. Supabase pgvectorì—ì„œ í•´ë‹¹ ì¹´í…Œê³ ë¦¬(dermatology / plastic_surgery)ë§Œ í•„í„°ë§í•˜ì—¬ ìœ ì‚¬ë„ ê²€ìƒ‰
3. ìœ ì‚¬ë„ 0.7 ì´ìƒ, ìƒìœ„ 5ê°œ ë°˜í™˜

**ì•ˆì „ í´ë°±:** ë²¡í„°DBì—ì„œ ìœ ì‚¬ë„ 0.7 ì´ìƒ ê²°ê³¼ê°€ ì—†ëŠ” ì‹œìˆ ì€ ë¦¬í¬íŠ¸ì— "ë‚´ì› ìƒë‹´ ì‹œ ìƒì„¸ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤"ë¡œ ì²˜ë¦¬.

### 7. ë¦¬í¬íŠ¸ ì‘ì„± ì—ì´ì „íŠ¸ (report_writer.py)

```
ì…ë ¥: 
  - í•œêµ­ì–´ RAG ë°ì´í„° (ì˜ë£Œ ì§€ì‹)
  - ì¼ë³¸ì–´ ì›ë¬¸ (ê³ ê° ë‰˜ì•™ìŠ¤)
  - ì˜ë„ ì¶”ì¶œ ê²°ê³¼
  - ë¶„ë¥˜ ê²°ê³¼
ì¶œë ¥: 7ì„¹ì…˜ ì¼ë³¸ì–´ ë¦¬í¬íŠ¸ JSON
```

**ì¤‘ìš”: ì´ ì—ì´ì „íŠ¸ì—ëŠ” í•œêµ­ì–´ RAG ë°ì´í„° + ì¼ë³¸ì–´ ì›ë¬¸ì„ ë™ì‹œì— ì œê³µí•œë‹¤.**
- ì˜ë£Œ ì •ë³´ì˜ ì •í™•ì„± â†’ í•œêµ­ì–´ RAG ë°ì´í„°ì—ì„œ
- ì¼ë³¸ì–´ í‘œí˜„ì˜ ìì—°ìŠ¤ëŸ¬ì›€ â†’ ì¼ë³¸ì–´ ì›ë¬¸ì—ì„œ

#### ë¦¬í¬íŠ¸ 7ì„¹ì…˜ êµ¬ì¡°

**ì„¹ì…˜1 â€” ä»Šå›ã®ã”ç›¸è«‡ã¾ã¨ã‚ (ìƒë‹´ ìš”ì•½)**
- ë³¸ë¬¸: ìƒë‹´ ë‚´ìš© 2~3ì¤„ ìš”ì•½
- í•µì‹¬ ê³ ë¯¼ 3ê°€ì§€ ë¦¬ìŠ¤íŠ¸

**ì„¹ì…˜2 â€” ã”å¸Œæœ›ã®æ–¹å‘æ€§ (í¬ë§ ë°©í–¥)**
- ì›í•˜ëŠ” ê²ƒ ë¦¬ìŠ¤íŠ¸ (âœ… ì•„ì´ì½˜)
- ì¸ìš© í˜•íƒœì˜ ìš”ì•½ í•œ ì¤„ (ê³ ê° ë§ ë‰˜ì•™ìŠ¤ ë°˜ì˜)

**ì„¹ì…˜3 â€” ç‰¹ã«ãŠæ°—ã«ã•ã‚Œã¦ã„ãŸç‚¹ (ìš°ë ¤ ì‚¬í•­)**
- ê³ ê°ì´ ë°˜ë³µ ì–¸ê¸‰í•œ í¬ì¸íŠ¸ ë¦¬ìŠ¤íŠ¸ (âš ï¸ ì•„ì´ì½˜)
- ë³´ì¶© ì„¤ëª… (ì‘ì€ ê¸€ì”¨)

**ì„¹ì…˜4 â€” åŒ»ç™‚çš„ãªã”èª¬æ˜ (ì˜ë£Œì  ì„¤ëª…)** â† RAG ì˜ì¡´ë„ ë†’ìŒ
- ë²ˆí˜¸ ì¹´ë“œ í˜•íƒœë¡œ ì˜ë£Œì  ê·¼ê±° ì„¤ëª… (3~4ê°œ)
- í•˜ë‹¨ ì£¼ì„: "ë¬¸ì œê°€ ìˆëŠ” ê²°ê³¼ë¼ê¸°ë³´ë‹¤ êµ¬ì¡°ì  íŠ¹ì„±ì…ë‹ˆë‹¤" ë¥˜ì˜ ì•ˆì‹¬ ë¬¸êµ¬

**ì„¹ì…˜5 â€” ã”ææ¡ˆã®æ–¹å‘æ€§ (ì œì•ˆ ë°©í–¥)** â† RAG ì˜ì¡´ë„ ë†’ìŒ
- STEP í˜•íƒœë¡œ ì ‘ê·¼ ë°©ë²• ì œì‹œ (3ë‹¨ê³„)
- í”¼ë¶€ê³¼: ì¹˜ë£Œ í”„ë¡œí† ì½œ, íšŸìˆ˜, ê°„ê²© ì¤‘ì‹¬
- ì„±í˜•ì™¸ê³¼: êµ¬ì¡°ì  ì ‘ê·¼ë²• ì¤‘ì‹¬

**ì„¹ì…˜6 â€” é¸æŠè‚¢ã®æ•´ç† (ì„ íƒì§€ ì •ë¦¬)**
- âœ… í•´ì•¼ í•  ê²ƒ (ê·¸ë¦° ê³„ì—´)
- ğŸ’¡ í•˜ë©´ ì¢‹ì€ ê²ƒ (ë¸”ë£¨ ê³„ì—´)
- â¸ ì•ˆ í•´ë„ ë˜ëŠ” ê²ƒ (ê·¸ë ˆì´ ê³„ì—´)
- í•˜ë‹¨ ì½”ë©˜íŠ¸

**ì„¹ì…˜7 â€” å›å¾©ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ç·åˆã‚³ãƒ¡ãƒ³ãƒˆ (íšŒë³µ/ì¼ì •/ì¢…í•©)**
- ì •ë³´ í…Œì´ë¸” (CT ì´¬ì˜, ë°œì‚¬ì¼, ì²´ë¥˜ ê¸°ê°„ ë“±)
- ì¢…í•© ì½”ë©˜íŠ¸ (ë¶€ë“œëŸ¬ìš´ ì œì•ˆí˜•)
- âš ï¸ ê°€ê²©/ë¹„ìš© ì •ë³´ ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠìŒ (ë³‘ì›ë§ˆë‹¤ ë‹¤ë¥´ê³  í†µì œ ë¶ˆê°€)

#### í†¤ì•¤ë§¤ë„ˆ
- ë¶€ë“œëŸ¬ìš´ ì œì•ˆí˜• ì–´íˆ¬: "ã€œã¨ç†è§£ã•ã‚Œã¾ã—ãŸ", "ã€œã¨è¦‹å—ã‘ã‚‰ã‚Œã¾ã—ãŸ", "ã€œã‚’ãŠå‹§ã‚ã„ãŸã—ã¾ã™"
- ì ˆëŒ€ ë‹¨ì •í˜• ì‚¬ìš© ê¸ˆì§€: "ã€œã§ã™", "ã€œã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“" âœ˜
- ì¼ë³¸ ì†Œë¹„ìê°€ ì•ˆì‹¬í•  ìˆ˜ ìˆëŠ” í†¤

#### ê³¼ë³„ ì„œë¸Œ í…œí”Œë¦¿ ì°¨ì´
- **ì„±í˜•ì™¸ê³¼**: êµ¬ì¡°ì  ì ‘ê·¼ë²• ì¤‘ì‹¬. "éª¨æ ¼ãƒ©ã‚¤ãƒ³ã®æ•´ç†", "è»Ÿéª¨ã®å†é…ç½®" ë“±
- **í”¼ë¶€ê³¼**: ì¹˜ë£Œ í”„ë¡œí† ì½œ ì¤‘ì‹¬. "ãƒ¬ãƒ¼ã‚¶ãƒ¼æ²»ç™‚Oå›ã‚³ãƒ¼ã‚¹", "Oé€±é–“é–“éš”ã§æ–½è¡“" ë“±

### 8. ê²€í†  ì—ì´ì „íŠ¸ (report_reviewer.py)

```
ì…ë ¥: ìƒì„±ëœ ë¦¬í¬íŠ¸ JSON
ì¶œë ¥: Pass / Fail + í”¼ë“œë°±
ìµœëŒ€ ì¬ì‹œë„: 3íšŒ
```

**ê²€í†  ê¸°ì¤€:**
- 7ì„¹ì…˜ ëª¨ë‘ ì¡´ì¬í•˜ëŠ”ê°€?
- ì¼ë³¸ì–´ ë¬¸ë²•/í‘œí˜„ì´ ìì—°ìŠ¤ëŸ¬ìš´ê°€?
- ì˜ë£Œ ì •ë³´ê°€ RAG ë°ì´í„°ì™€ ì¼ì¹˜í•˜ëŠ”ê°€?
- ê°€ê²©/ë¹„ìš© ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•Šì€ê°€?
- í†¤ì•¤ë§¤ë„ˆê°€ ì œì•ˆí˜•ì¸ê°€?
- ì•ˆì „ í´ë°±ì´ ì ì ˆíˆ ì ìš©ë˜ì—ˆëŠ”ê°€?

Fail ì‹œ í”¼ë“œë°±ê³¼ í•¨ê»˜ ë¦¬í¬íŠ¸ ì‘ì„± ì—ì´ì „íŠ¸ì— ì¬ì „ë‹¬. 3íšŒ ì‹¤íŒ¨ ì‹œ í˜„ì¬ ìƒíƒœë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬ìì—ê²Œ ìˆ˜ë™ ê²€í†  ìš”ì²­.

### 9. í•œêµ­ì–´ ë²ˆì—­ ì—ì´ì „íŠ¸ (korean_translator.py)

```
ì…ë ¥: ì¼ë³¸ì–´ ë¦¬í¬íŠ¸ JSON
ì¶œë ¥: í•œêµ­ì–´ ë¦¬í¬íŠ¸ JSON (ë™ì¼ êµ¬ì¡°)
```

ê´€ë¦¬ìê°€ "í•œê¸€ ë³´ê¸°" í† ê¸€ ì‹œ í˜¸ì¶œ. ë²ˆì—­ ê²°ê³¼ëŠ” `reports.report_data_ko`ì— ìºì‹±í•˜ì—¬ ì¬í˜¸ì¶œ ë°©ì§€.

---

## YouTube ìë§‰ â†’ ë²¡í„°DB íŒŒì´í”„ë¼ì¸

### ì²˜ë¦¬ íë¦„

```
[YouTube ì˜ìƒ URL/ID ë“±ë¡]
       â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ YouTube API    â”‚ â†’ ì˜ìƒ ë©”íƒ€ë°ì´í„° í™•ì¸ + ìë™ ìƒì„± ìë§‰ í™•ì¸
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€ ìë™ ìë§‰ ì—†ìŒ â†’ status: 'skipped' (ìŠ¤í‚µ)
       â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ìë§‰ ì¶”ì¶œ      â”‚ â†’ ìë™ ìƒì„± ìë§‰(transcript) í…ìŠ¤íŠ¸ ì¶”ì¶œ
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ìë§‰ ì •ì œ (LLM) â”‚ â†’ ì˜¤íƒˆì ìˆ˜ì •, ì˜ë£Œ ìš©ì–´ êµì •, ë¬¸ì¥ ë‹¨ìœ„ ì •ë¦¬
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â†’ "ìš¸ì„¸ë¼" â†’ "ìš¸ì„ë¼", "í•˜ì´í›„" â†’ "í•˜ì´í‘¸" ë“±
       â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ FAQ ë³€í™˜ (LLM)  â”‚ â†’ ì •ì œëœ í…ìŠ¤íŠ¸ì—ì„œ Q&A ìŒ ì¶”ì¶œ
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ì„ë² ë”© + ì €ì¥   â”‚ â†’ Gemini Embedding 768 â†’ Supabase pgvector
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### FAQ ë³€í™˜ í”„ë¡¬í”„íŠ¸ í•µì‹¬

```
ì´ ì˜ë£Œ ì˜ìƒ ìë§‰ì—ì„œ FAQë¥¼ ì¶”ì¶œí•´ì£¼ì„¸ìš”.
ê° FAQëŠ” ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±:
- question: í™˜ì ê´€ì ì˜ ì§ˆë¬¸ (ì˜ˆ: "ì½”ëì´ ë¾°ì¡±í•´ ë³´ì´ëŠ” ì´ìœ ëŠ”?")
- answer: ì˜ë£Œì§„ ì„¤ëª… (ê·¼ê±° í¬í•¨, 2~3ë¬¸ì¥)
- procedure_name: ê´€ë ¨ ì‹œìˆ ëª…
- category: "dermatology" ë˜ëŠ” "plastic_surgery"

JSON ë°°ì—´ë¡œ ë°˜í™˜.
```

### ìë§‰ ì—†ëŠ” ì˜ìƒ ì²˜ë¦¬

ìë™ ìƒì„± ìë§‰ì´ ì—†ëŠ” ì˜ìƒì€ **ìŠ¤í‚µí•œë‹¤.** YouTubeì— í”¼ë¶€ê³¼/ì„±í˜•ì™¸ê³¼ ì˜ìƒì´ ìˆ˜ì²œ ê°œ ìˆìœ¼ë¯€ë¡œ ìë§‰ ì—†ëŠ” ê²ƒì€ ë¬´ì‹œí•´ë„ ì¶©ë¶„í•œ ë°ì´í„°ë¥¼ í™•ë³´í•  ìˆ˜ ìˆë‹¤.

---

## ê´€ë¦¬ìí˜ì´ì§€ ìƒì„¸ ì„¤ê³„ (í•œêµ­ì–´)

> âš ï¸ /design-reference/admin-template.html íŒŒì¼ì´ ë””ìì¸ ì›ë³¸ì´ë‹¤.
> ì´ HTMLì˜ ë ˆì´ì•„ì›ƒ, ìƒ‰ìƒ, í°íŠ¸, ê°„ê²©ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•  ê²ƒ.
> React/Next.js ì»´í¬ë„ŒíŠ¸ë¡œ ë³€í™˜í•˜ë˜ ë””ìì¸ í†¤ì„ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ë§ ê²ƒ.

### ê³µí†µ ë ˆì´ì•„ì›ƒ

- ì¢Œì¸¡ ì‚¬ì´ë“œë°” (240px) + ìš°ì¸¡ ë©”ì¸ ì½˜í…ì¸ 
- ì‚¬ì´ë“œë°” ë°°ê²½: #1E293B, í…ìŠ¤íŠ¸: #CBD5E1, í™œì„± ë©”ë‰´: #3B82F6
- ë©”ì¸ ë°°ê²½: #F8FAFC
- í°íŠ¸: Pretendard ë˜ëŠ” Noto Sans KR

**ì‚¬ì´ë“œë°” ë©”ë‰´:**
```
ğŸ“Š ëŒ€ì‹œë³´ë“œ
ğŸ“‹ ìƒë‹´ ê´€ë¦¬
âš ï¸ ë¯¸ë¶„ë¥˜ ì²˜ë¦¬  [ë°°ì§€: Nê±´]
ğŸ“„ ë¦¬í¬íŠ¸ ê´€ë¦¬
```

### 1. ëŒ€ì‹œë³´ë“œ (/admin)

**ìƒë‹¨ ìš”ì•½ ì¹´ë“œ 4ê°œ (ê°€ë¡œ ë°°ì—´):**
- ì´ ìƒë‹´ ê±´ìˆ˜
- ë¯¸ë¶„ë¥˜ ëŒ€ê¸° ê±´ìˆ˜ (âš ï¸)
- ë¦¬í¬íŠ¸ ëŒ€ê¸° ê±´ìˆ˜
- ë°œì†¡ ì™„ë£Œ ê±´ìˆ˜ + ì—´ëŒë¥ 

**CTA í˜„í™© ì¹´ë“œ:**
- ğŸ”´ Hot: Nê±´ (N%)
- ğŸŸ¡ Warm: Nê±´ (N%)
- ğŸ”µ Cool: Nê±´ (N%)
- ê°€ë¡œ ë°” ì°¨íŠ¸ë¡œ ì‹œê°í™”

**ìµœê·¼ ìƒë‹´ ëª©ë¡ í…Œì´ë¸” (ìµœê·¼ 10ê±´):**
- ì»¬ëŸ¼: ê³ ê°ëª…, ë¶„ë¥˜, CTA, ë¦¬í¬íŠ¸ ìƒíƒœ, ë“±ë¡ì¼
- CTA ë°°ì§€: Hot=ë ˆë“œ, Warm=ì˜ë¡œ, Cool=ë¸”ë£¨
- ë¶„ë¥˜ ë°°ì§€: ì„±í˜•ì™¸ê³¼=ğŸ¥, í”¼ë¶€ê³¼=ğŸ’Š, ë¯¸ë¶„ë¥˜=âš ï¸

### 2. ìƒë‹´ ê´€ë¦¬ (/admin/consultations)

**ìƒë‹¨:** [+ ìƒˆ ìƒë‹´ ë“±ë¡] ë²„íŠ¼ + ê²€ìƒ‰ + í•„í„°(ë¶„ë¥˜, ìƒíƒœ)

**ìƒë‹´ ëª©ë¡ í…Œì´ë¸”:**
- ì»¬ëŸ¼: ì²´í¬ë°•ìŠ¤, ê³ ê°ëª…, ì´ë©”ì¼, ë¶„ë¥˜, CTA, ìƒíƒœ, ë“±ë¡ì¼
- í–‰ í´ë¦­ â†’ ìƒì„¸ í™”ë©´ ì´ë™
- í˜ì´ì§€ë„¤ì´ì…˜

**ìƒˆ ìƒë‹´ ë“±ë¡ ëª¨ë‹¬ (/admin/consultations/new):**
- ê³ ê°ëª… (í•„ìˆ˜)
- ì´ë©”ì¼ (í•„ìˆ˜)
- LINE ID (ì„ íƒ)
- ì…ë ¥ ë°©ì‹ ì„ íƒ: STT íŒŒì¼ ì—…ë¡œë“œ / ë‹¤ì´ì–¼ë¡œê·¸ ì§ì ‘ ì…ë ¥
- STT: ë“œë˜ê·¸ì•¤ë“œë¡­ íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­
- ë‹¤ì´ì–¼ë¡œê·¸: í…ìŠ¤íŠ¸ ì—ì–´ë¦¬ì–´
- [ì·¨ì†Œ] [ë“±ë¡í•˜ê¸°] ë²„íŠ¼

**ìƒë‹´ ìƒì„¸ í™”ë©´ (/admin/consultations/[id]):**

ìƒë‹¨:
- â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° + "ç”°ä¸­æ§˜ ìƒë‹´ ìƒì„¸" íƒ€ì´í‹€

ì¢Œì¸¡ ì¹´ë“œ - ê³ ê° ì •ë³´:
- ì´ë¦„, ì´ë©”ì¼, LINE ID, ë“±ë¡ì¼

ìš°ì¸¡ ì¹´ë“œ - AI ë¶„ì„ ê²°ê³¼:
- ë¶„ë¥˜: ğŸ¥ ì„±í˜•ì™¸ê³¼ (ë˜ëŠ” ğŸ’Š í”¼ë¶€ê³¼)
- CTA: ğŸ”´ Hot (ë˜ëŠ” ğŸŸ¡ Warm, ğŸ”µ Cool)
- CTA íŒë‹¨ ê·¼ê±° (ê³ ê° ë°œí™” ëª©ë¡, ì¼ë³¸ì–´)
- CTA ìˆ˜ë™ ë³€ê²½ ë“œë¡­ë‹¤ìš´

í•˜ë‹¨ ì¹´ë“œ - ìƒë‹´ ì›ë¬¸:
- [ì¼ë³¸ì–´ ì›ë¬¸] / [í•œêµ­ì–´ ë²ˆì—­] íƒ­ ì „í™˜
- í™”ì êµ¬ë¶„ í‘œì‹œ: ìƒë‹´ì‚¬=ê·¸ë ˆì´ ë°°ê²½, ê³ ê°=í° ë°°ê²½
- í•˜ë‹¨: [ë¦¬í¬íŠ¸ ë³´ê¸° â†’] ë§í¬

### 3. ë¯¸ë¶„ë¥˜ ì²˜ë¦¬ (/admin/unclassified)

**ë¯¸ë¶„ë¥˜ ê±´ ëª©ë¡ í…Œì´ë¸”:**
- ì»¬ëŸ¼: ê³ ê°ëª…, ë“±ë¡ì¼, ì£¼ìš” í‚¤ì›Œë“œ(AI ì¶”ì¶œ), [ë¶„ë¥˜í•˜ê¸°] ë²„íŠ¼

**ë¶„ë¥˜ ëª¨ë‹¬:**
- AI ì¶”ì¶œ í‚¤ì›Œë“œ í‘œì‹œ
- ìƒë‹´ ì›ë¬¸ ë¯¸ë¦¬ë³´ê¸° (3~4ì¤„ + [ì „ì²´ ë³´ê¸°])
- ë¶„ë¥˜ ì„ íƒ: [ğŸ’Š í”¼ë¶€ê³¼] [ğŸ¥ ì„±í˜•ì™¸ê³¼] í° ë²„íŠ¼ 2ê°œ
- [í™•ì¸] ë²„íŠ¼ â†’ ë¶„ë¥˜ í›„ íŒŒì´í”„ë¼ì¸ ìë™ ì¬ê°œ

### 4. ë¦¬í¬íŠ¸ ê´€ë¦¬ (/admin/reports)

**ë¦¬í¬íŠ¸ ëª©ë¡ í…Œì´ë¸”:**
- ì»¬ëŸ¼: ê³ ê°ëª…, ë¶„ë¥˜, ìƒíƒœ, ë°œì†¡ì¼, ì—´ëŒ ì—¬ë¶€, [ë³´ê¸°/ê²€í† ] ë²„íŠ¼
- ìƒíƒœ ë°°ì§€: ë°œì†¡ì™„ë£Œ=ê·¸ë¦°, ìŠ¹ì¸ëŒ€ê¸°=ì˜ë¡œ, ìƒì„±ì™„ë£Œ=ë¸”ë£¨, ë¶„ë¥˜ëŒ€ê¸°=ê·¸ë ˆì´

**ë¦¬í¬íŠ¸ ìƒì„¸/ê²€í†  í™”ë©´ (/admin/reports/[id]):**

ìƒë‹¨: â† ëª©ë¡ìœ¼ë¡œ + "ç”°ä¸­æ§˜ ë¦¬í¬íŠ¸ ê²€í† " íƒ€ì´í‹€

ë©”ì¸ ì˜ì—­:
- [ì¼ë³¸ì–´ ì›ë¬¸] / [í•œê¸€ ë²ˆì—­] í† ê¸€ íƒ­
  - í•œê¸€ ë²ˆì—­ í´ë¦­ ì‹œ: ìºì‹œ ìˆìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ, ì—†ìœ¼ë©´ LLM ë²ˆì—­ ì—ì´ì „íŠ¸ í˜¸ì¶œ í›„ ìºì‹œ ì €ì¥
- ë¦¬í¬íŠ¸ ë¯¸ë¦¬ë³´ê¸°: ëª¨ë°”ì¼ í”„ë ˆì„(480px) ì•ˆì— ì‹¤ì œ ì†Œë¹„ì ë·°ì™€ ë™ì¼í•˜ê²Œ ë Œë”ë§
  - 7ì„¹ì…˜ ì „ì²´ ìŠ¤í¬ë¡¤ í‘œì‹œ

í•˜ë‹¨ ë²„íŠ¼:
- [âŒ ë°˜ë ¤] [âœï¸ ìˆ˜ì •] [âœ… ìŠ¹ì¸] 3ê°œ ë²„íŠ¼
- ìˆ˜ì •: í…ìŠ¤íŠ¸ ì—ë””í„° ëª¨ë“œë¡œ ì „í™˜, ì„¹ì…˜ë³„ ë‚´ìš© ìˆ˜ì • ê°€ëŠ¥

ìŠ¹ì¸ ì‹œ:
- í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸: "ì´ë©”ì¼ì´ ìë™ ë°œì†¡ë©ë‹ˆë‹¤. ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
- ìŠ¹ì¸ í›„ í‘œì‹œ:
  - âœ… ì´ë©”ì¼ ìë™ ë°œì†¡ ì™„ë£Œ (tanaka@email.jp)
  - ğŸ“ [URL ê³µìœ ] ë²„íŠ¼ â†’ ë“œë¡­ë‹¤ìš´: "ë§í¬ ë³µì‚¬" / "LINEìœ¼ë¡œ ê³µìœ "
- ë°œì†¡ ì´ë ¥: ë°œì†¡ ì‹œê°„, ì—´ëŒ ì—¬ë¶€

---

## ì†Œë¹„ì ë¦¬í¬íŠ¸ ì›¹í˜ì´ì§€ ìƒì„¸ ì„¤ê³„ (ì¼ë³¸ì–´)

> âš ï¸ /design-reference/report-template.html íŒŒì¼ì´ ë””ìì¸ ì›ë³¸ì´ë‹¤.
> ì´ HTMLì˜ ë ˆì´ì•„ì›ƒ, ìƒ‰ìƒ, í°íŠ¸, ê°„ê²©ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•  ê²ƒ.
> React/Next.js ì»´í¬ë„ŒíŠ¸ë¡œ ë³€í™˜í•˜ë˜ ë””ìì¸ í†¤ì„ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ë§ ê²ƒ.

### ì ‘ê·¼ ë°©ì‹
- URL: `/report/{access_token}`
- ë³¸ì¸ í™•ì¸: ìƒë…„ì›”ì¼ ì…ë ¥ (í† í° + ìƒë…„ì›”ì¼ ì¼ì¹˜ ì‹œ ì—´ëŒ ê°€ëŠ¥)
- ìœ íš¨ê¸°ê°„: 30ì¼

### ë””ìì¸ ì‚¬ì–‘
- **ëª¨ë°”ì¼ ìµœì í™” í•„ìˆ˜** (ì¼ë³¸ ì†Œë¹„ì ëŒ€ë¶€ë¶„ ìŠ¤ë§ˆíŠ¸í° ì—´ëŒ)
- ìµœëŒ€ í­: 480px
- ì›í˜ì´ì§€ ìŠ¤í¬ë¡¤ (7ì„¹ì…˜ ì„¸ë¡œ ìŠ¤í¬ë¡¤)
- í°íŠ¸: Noto Sans JP
- ë©”ì¸: #FAFAFA, í…ìŠ¤íŠ¸: #2C3E50, í¬ì¸íŠ¸: #E8927C (ì½”ë„ í•‘í¬)
- ì¹´ë“œ: í°ìƒ‰, ë¼ìš´ë“œ 12px, ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì
- ì„¸ì…˜ ê°„ 40px ì—¬ë°±
- ìŠ¤í¬ë¡¤ ì‹œ ì„¹ì…˜ í˜ì´ë“œì¸ ì• ë‹ˆë©”ì´ì…˜ (ê²½ëŸ‰)

### 7ì„¹ì…˜ ì»´í¬ë„ŒíŠ¸

ê° ì„¹ì…˜ì€ ë…ë¦½ React ì»´í¬ë„ŒíŠ¸ë¡œ êµ¬í˜„:
- `Section1Summary` â€” ìƒë‹´ ìš”ì•½
- `Section2Direction` â€” í¬ë§ ë°©í–¥
- `Section3Concerns` â€” ìš°ë ¤ ì‚¬í•­
- `Section4Medical` â€” ì˜ë£Œì  ì„¤ëª… (RAG ê¸°ë°˜)
- `Section5Proposal` â€” ì œì•ˆ ë°©í–¥ (RAG ê¸°ë°˜)
- `Section6Options` â€” ì„ íƒì§€ ì •ë¦¬
- `Section7Recovery` â€” íšŒë³µ/ì¼ì •/ì¢…í•© ì½”ë©˜íŠ¸

### í—¤ë”/í‘¸í„°
- í—¤ë”: "ì´ë½€ | åŒ–ç²§ç›¸è«‡ãƒªãƒãƒ¼ãƒˆ" ë¡œê³  + ê³ ê°ëª… + ìƒë‹´ ì œëª© + ë‚ ì§œ
- í‘¸í„°: "ì´ë½€(ì´ë½€) | éŸ“å›½ç¾å®¹åŒ»ç™‚ã‚³ãƒ³ã‚µãƒ«ãƒ†ã‚£ãƒ³ã‚°" + ë©´ì±… ë¬¸êµ¬ + ë¬¸ì˜ ë§í¬

---

## ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ

### ë°œì†¡ íë¦„

```
[ê´€ë¦¬ì ë¦¬í¬íŠ¸ ìŠ¹ì¸]
       â”‚
       â”œâ”€â”€â†’ [ì´ë©”ì¼ ìë™ ë°œì†¡] Resend API
       â”‚    From: report@ippo.co.kr
       â”‚    Reply-To: {REPLY_TO_EMAIL} (.envì—ì„œ)
       â”‚    To: ê³ ê° ì´ë©”ì¼
       â”‚    ë‚´ìš©: ë¦¬í¬íŠ¸ URL í¬í•¨
       â”‚
       â””â”€â”€â†’ [URL ê³µìœ  ë²„íŠ¼] ê´€ë¦¬ìí˜ì´ì§€ì—ì„œ
            â”œâ”€â”€ ë§í¬ ë³µì‚¬ (í´ë¦½ë³´ë“œ)
            â””â”€â”€ LINE ê³µìœ  (Web Share API â†’ LINE ì•± ì˜¤í”ˆ)
```

### ì´ë©”ì¼ ë‚´ìš©
- ì œëª©: "ã€ì´ë½€ã€‘OOæ§˜ ã”ç›¸è«‡ãƒªãƒãƒ¼ãƒˆãŒå±Šãã¾ã—ãŸ"
- ë³¸ë¬¸: ê°„ë‹¨í•œ ì¸ì‚¬ + ë¦¬í¬íŠ¸ URL ë§í¬ + ìœ íš¨ê¸°ê°„ ì•ˆë‚´
- ë””ìì¸: ì‹¬í”Œí•˜ê³  ê¹”ë”í•œ HTML ì´ë©”ì¼

### URL ê³µìœ  ë²„íŠ¼ (ShareButton.tsx)
- ë²„íŠ¼ í´ë¦­ â†’ ë“œë¡­ë‹¤ìš´ ë©”ë‰´
- "ë§í¬ ë³µì‚¬": `navigator.clipboard.writeText(url)`
- "LINEìœ¼ë¡œ ê³µìœ ": ëª¨ë°”ì¼ì—ì„œ Web Share API ì‚¬ìš© ì‹œ LINE ì•± ë°”ë¡œ ì—´ë¦¼
  - ë°ìŠ¤í¬í†±: `https://social-plugins.line.me/lineit/share?url={encoded_url}`

---

## API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„ (FastAPI)

### ìƒë‹´ ê´€ë ¨

```
POST   /api/consultations          # ìƒˆ ìƒë‹´ ë“±ë¡ (íŒŒì´í”„ë¼ì¸ ìë™ ì‹œì‘)
GET    /api/consultations          # ìƒë‹´ ëª©ë¡ (í•„í„°: classification, status, page)
GET    /api/consultations/{id}     # ìƒë‹´ ìƒì„¸
PUT    /api/consultations/{id}/classify  # ìˆ˜ë™ ë¶„ë¥˜ (ë¯¸ë¶„ë¥˜ â†’ í”¼ë¶€ê³¼/ì„±í˜•ì™¸ê³¼, íŒŒì´í”„ë¼ì¸ ì¬ê°œ)
PUT    /api/consultations/{id}/cta      # CTA ë ˆë²¨ ìˆ˜ë™ ë³€ê²½
```

### ë¦¬í¬íŠ¸ ê´€ë ¨

```
GET    /api/reports                # ë¦¬í¬íŠ¸ ëª©ë¡
GET    /api/reports/{id}           # ë¦¬í¬íŠ¸ ìƒì„¸
PUT    /api/reports/{id}/approve   # ë¦¬í¬íŠ¸ ìŠ¹ì¸ â†’ ì´ë©”ì¼ ìë™ ë°œì†¡ + URL ìƒì„±
PUT    /api/reports/{id}/reject    # ë¦¬í¬íŠ¸ ë°˜ë ¤
PUT    /api/reports/{id}/edit      # ë¦¬í¬íŠ¸ ë‚´ìš© ìˆ˜ì •
GET    /api/reports/{id}/translate # í•œêµ­ì–´ ë²ˆì—­ ìš”ì²­ (ìºì‹±)
```

### ì†Œë¹„ì ë¦¬í¬íŠ¸

```
GET    /api/public/report/{token}           # ë¦¬í¬íŠ¸ ì—´ëŒ (í† í° + ìœ íš¨ê¸°ê°„ ê²€ì¦)
POST   /api/public/report/{token}/verify    # ë³¸ì¸ í™•ì¸ (ìƒë…„ì›”ì¼)
POST   /api/public/report/{token}/opened    # ì—´ëŒ ì¶”ì  (ì´ë©”ì¼ ì—´ëŒ ê¸°ë¡)
```

### YouTube/ë²¡í„°DB

```
POST   /api/youtube/add            # YouTube ì˜ìƒ URL ë“±ë¡
POST   /api/youtube/process        # ë“±ë¡ëœ ì˜ìƒ ì¼ê´„ ì²˜ë¦¬ (ìë§‰â†’ì •ì œâ†’FAQâ†’ì„ë² ë”©)
GET    /api/youtube/sources        # ë“±ë¡ëœ ì˜ìƒ ëª©ë¡ + ì²˜ë¦¬ ìƒíƒœ
```

### ëŒ€ì‹œë³´ë“œ

```
GET    /api/dashboard/stats        # ëŒ€ì‹œë³´ë“œ í†µê³„ (ì´ ìƒë‹´, ë¯¸ë¶„ë¥˜, ëŒ€ê¸°, ë°œì†¡, CTA í˜„í™©)
```

---

## ë°°í¬ ì„¤ì •

### Vercel (í”„ë¡ íŠ¸ì—”ë“œ)

```json
// vercel.json
{
  "framework": "nextjs",
  "buildCommand": "cd frontend && npm run build",
  "outputDirectory": "frontend/.next",
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://ippo-backend-XXXXX-an.a.run.app/api/:path*"
    }
  ]
}
```

### Google Cloud Run (ë°±ì—”ë“œ)

```dockerfile
# backend/Dockerfile
FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8080"]
```

```yaml
# backend/requirements.txt
fastapi
uvicorn[standard]
google-generativeai
supabase
resend
youtube-transcript-api
pydantic
python-dotenv
httpx
```

### Cloud Run ë°°í¬ ì»¤ë§¨ë“œ

```bash
cd backend
gcloud run deploy ippo-backend \
  --source . \
  --region asia-northeast1 \
  --allow-unauthenticated \
  --set-env-vars "GEMINI_API_KEY=...,SUPABASE_URL=...,SUPABASE_SERVICE_KEY=...,RESEND_API_KEY=...,YOUTUBE_API_KEY=...,REPLY_TO_EMAIL=..."
```

---

## ë¶„ë¥˜ í‚¤ì›Œë“œ ì‚¬ì „ ì´ˆê¸° ë°ì´í„°

```sql
-- ì„±í˜•ì™¸ê³¼ ëª…í™• í‚¤ì›Œë“œ
INSERT INTO classification_keywords (category, keyword) VALUES
('plastic_surgery', 'ìŒêº¼í’€'),
('plastic_surgery', 'ì½” ì„±í˜•'),
('plastic_surgery', 'ì½”ë'),
('plastic_surgery', 'ì½”ë“±'),
('plastic_surgery', 'ì§€ë°©í¡ì…'),
('plastic_surgery', 'ì•ˆë©´ìœ¤ê³½'),
('plastic_surgery', 'ì–‘ì•…'),
('plastic_surgery', 'ì´ë§ˆ ë¦¬í”„íŒ…'),
('plastic_surgery', 'ëˆˆ ì¬ìˆ˜ìˆ '),
('plastic_surgery', 'ê°€ìŠ´ ìˆ˜ìˆ '),
('plastic_surgery', 'í„± ìˆ˜ìˆ '),
('plastic_surgery', 'Vë¼ì¸'),
('plastic_surgery', 'ë¦¬í”„íŒ… ì‹¤'),
('plastic_surgery', 'ì½” ì¬ìˆ˜ìˆ ');

-- í”¼ë¶€ê³¼ ëª…í™• í‚¤ì›Œë“œ
INSERT INTO classification_keywords (category, keyword) VALUES
('dermatology', 'ì—¬ë“œë¦„'),
('dermatology', 'ê¸°ë¯¸'),
('dermatology', 'ìƒ‰ì†Œ'),
('dermatology', 'ëª¨ê³µ'),
('dermatology', 'íƒˆëª¨'),
('dermatology', 'ë ˆì´ì €'),
('dermatology', 'í•˜ì´í‘¸'),
('dermatology', 'ìš¸ì„ë¼'),
('dermatology', 'í”¼ë¶€ê²°'),
('dermatology', 'ì£¼ë¦„ ê°œì„ '),
('dermatology', 'íƒ„ë ¥'),
('dermatology', 'ë¦¬ì¥¬ë€'),
('dermatology', 'ìŠ¤í‚¨ ë¶€ìŠ¤í„°');

-- ê²½ê³„ ì‹œìˆ  + ë™ë°˜ í‚¤ì›Œë“œ
INSERT INTO classification_keywords (category, keyword, context_keywords) VALUES
('boundary', 'ë³´í†¡ìŠ¤', '{"plastic_surgery": ["ì½” ë†’ì´ê¸°", "í„± ë", "ìœ¤ê³½", "ì´ë§ˆ ë³¼ë¥¨", "ë¦¬í”„íŒ… ì‹¤"], "dermatology": ["ë ˆì´ì €", "í•˜ì´í‘¸", "ìš¸ì„ë¼", "í”¼ë¶€ê²°", "ì£¼ë¦„ ê°œì„ ", "íƒ„ë ¥", "ë¦¬ì¥¬ë€"]}'),
('boundary', 'í•„ëŸ¬', '{"plastic_surgery": ["ì½” ë†’ì´ê¸°", "í„± ë", "ìœ¤ê³½", "ì´ë§ˆ ë³¼ë¥¨", "ë¦¬í”„íŒ… ì‹¤"], "dermatology": ["ë ˆì´ì €", "í•˜ì´í‘¸", "ìš¸ì„ë¼", "í”¼ë¶€ê²°", "ì£¼ë¦„ ê°œì„ ", "íƒ„ë ¥", "ë¦¬ì¥¬ë€"]}');
```

---

## ì‹¤í–‰ ìˆœì„œ (Claude Code ì‘ì—… ìˆœì„œ)

### Phase 1: ì¸í”„ë¼ ì„¸íŒ…
1. Supabase í”„ë¡œì íŠ¸ì— pgvector í™•ì¥ í™œì„±í™”
2. ìœ„ SQL ìŠ¤í‚¤ë§ˆ ì „ì²´ ì‹¤í–‰ (í…Œì´ë¸” + í•¨ìˆ˜ + ì¸ë±ìŠ¤)
3. ë¶„ë¥˜ í‚¤ì›Œë“œ ì´ˆê¸° ë°ì´í„° INSERT
4. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±

### Phase 2: ë°±ì—”ë“œ íŒŒì´í”„ë¼ì¸ (Python FastAPI)
1. FastAPI ì•± ê¸°ë³¸ êµ¬ì¡° + í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
2. Supabase í´ë¼ì´ì–¸íŠ¸ ì—°ê²°
3. Gemini í´ë¼ì´ì–¸íŠ¸ (LLM + ì„ë² ë”©)
4. ê° ì—ì´ì „íŠ¸ ìˆœì„œëŒ€ë¡œ êµ¬í˜„:
   - translator â†’ cta_analyzer â†’ intent_extractor â†’ classifier â†’ validator â†’ rag_agent â†’ report_writer â†’ report_reviewer â†’ korean_translator
5. íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° (pipeline.py)
6. API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
7. Resend ì´ë©”ì¼ ë°œì†¡
8. YouTube ìë§‰ ìˆ˜ì§‘ íŒŒì´í”„ë¼ì¸

### Phase 3: í”„ë¡ íŠ¸ì—”ë“œ (Next.js)
1. Next.js í”„ë¡œì íŠ¸ ìƒì„± + Tailwind ì„¤ì •
2. design-reference/ HTML íŒŒì¼ ì°¸ê³ í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
3. ê´€ë¦¬ìí˜ì´ì§€ 4ê°œ í™”ë©´:
   - ëŒ€ì‹œë³´ë“œ â†’ ìƒë‹´ ê´€ë¦¬ â†’ ë¯¸ë¶„ë¥˜ ì²˜ë¦¬ â†’ ë¦¬í¬íŠ¸ ê´€ë¦¬
4. ì†Œë¹„ì ë¦¬í¬íŠ¸ í˜ì´ì§€ (7ì„¹ì…˜)
5. Supabase ì¸ì¦ ì—°ë™ (ê´€ë¦¬ì ë¡œê·¸ì¸)
6. Cloud Run API ì—°ê²°

### Phase 4: ë°°í¬
1. ë°±ì—”ë“œ â†’ Docker ë¹Œë“œ â†’ Cloud Run ë°°í¬
2. í”„ë¡ íŠ¸ì—”ë“œ â†’ Vercel ë°°í¬
3. Vercelì—ì„œ Cloud Run API í”„ë¡ì‹œ ì„¤ì •
4. Resend ë„ë©”ì¸ ì„¤ì •
5. í†µí•© í…ŒìŠ¤íŠ¸

---

## í•µì‹¬ ì£¼ì˜ì‚¬í•­

1. **API í‚¤ëŠ” ì ˆëŒ€ í”„ë¡ íŠ¸ì—”ë“œì— ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.** ëª¨ë“  í‚¤ëŠ” .envì—ì„œ ì„œë²„ë‹¨ìœ¼ë¡œë§Œ.
2. **ì¼ë³¸ì–´ ì›ë¬¸ì€ ë°˜ë“œì‹œ ë³´ì¡´í•œë‹¤.** ë²ˆì—­ í›„ì—ë„ ì›ë¬¸ DBì— ë‚¨ê²¨ì•¼ í•œë‹¤.
3. **ë¶„ë¥˜ëŠ” ë‹¨ì¼ ë¶„ë¥˜ ì›ì¹™.** í”¼ë¶€ê³¼ OR ì„±í˜•ì™¸ê³¼, í˜¼í•© ë¶ˆê°€.
4. **ë¯¸ë¶„ë¥˜ëŠ” íŒŒì´í”„ë¼ì¸ ì¤‘ë‹¨.** ê´€ë¦¬ì ìˆ˜ë™ ë¶„ë¥˜ í›„ ì¬ê°œ.
5. **ë¦¬í¬íŠ¸ì— ê°€ê²©/ë¹„ìš© ì •ë³´ ì ˆëŒ€ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤.**
6. **CTAëŠ” ë¦¬í¬íŠ¸ì— ë„£ì§€ ì•ŠëŠ”ë‹¤.** ê´€ë¦¬ìí˜ì´ì§€ ë‚´ë¶€ ë°ì´í„°ë¡œë§Œ í™œìš©.
7. **ë²¡í„°DB ê²€ìƒ‰ ì‹œ ì¹´í…Œê³ ë¦¬ í•„í„° í•„ìˆ˜.** í”¼ë¶€ê³¼ ìƒë‹´ì— ì„±í˜•ì™¸ê³¼ ë°ì´í„°ê°€ ë‚˜ì˜¤ë©´ ì•ˆ ëœë‹¤.
8. **YouTube ìë™ ìë§‰ ì—†ëŠ” ì˜ìƒì€ ìŠ¤í‚µ.** ì²˜ë¦¬í•˜ë ¤ê³  ì‹œê°„ ì“°ì§€ ë§ ê²ƒ.
9. **ë¦¬í¬íŠ¸ í†¤: ë¶€ë“œëŸ¬ìš´ ì œì•ˆí˜•.** ë‹¨ì •í˜•/ëª…ë ¹í˜• ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€.
10. **ëª¨ë°”ì¼ ìµœì í™” í•„ìˆ˜.** ë¦¬í¬íŠ¸ í˜ì´ì§€ëŠ” 480px ê¸°ì¤€ìœ¼ë¡œ ë””ìì¸.
